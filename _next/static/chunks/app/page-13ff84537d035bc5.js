(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{53428:(e,t,a)=>{"use strict";a.d(t,{default:()=>w});var l=a(95155),n=a(12115),o=a(74211),r=a(93306),s=a(57916);a(11687);let d={width:"10px",height:"10px",background:"#555",borderRadius:"50%",transition:"opacity 0.2s ease-in-out"},i=(e,t)=>e?e.length<=t?e:"".concat(e.substring(0,t),"..."):"",c=["#555","#ff0000","#00ff00","#0000ff","#ffc107"],u=["rectangle","circle","diamond"],p=e=>{let{id:t,top:a,left:n,onStyleChange:o,onClose:r}=e;return(0,l.jsxs)("div",{style:{position:"absolute",top:a,left:n,zIndex:1e3,background:"white",border:"1px solid #ddd",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",padding:"8px"},onMouseLeave:r,children:[(0,l.jsxs)("div",{style:{marginBottom:"8px"},children:[(0,l.jsx)("div",{style:{fontSize:"12px",color:"#555",marginBottom:"4px"},children:"Color"}),(0,l.jsx)("div",{style:{display:"flex",gap:"4px"},children:c.map(e=>(0,l.jsx)("button",{style:{width:"20px",height:"20px",background:e,border:"1px solid #ccc",borderRadius:"50%",cursor:"pointer"},onClick:()=>{o(t,{color:e}),r()}},e))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{style:{fontSize:"12px",color:"#555",marginBottom:"4px"},children:"Shape"}),(0,l.jsx)("div",{style:{display:"flex",gap:"4px"},children:u.map(e=>(0,l.jsx)("button",{style:{padding:"4px 8px",fontSize:"12px",border:"1px solid #ccc",borderRadius:"4px",cursor:"pointer"},onClick:()=>{o(t,{shape:e}),r()},children:e},e))})]})]})};var x=a(28175),h=a.n(x);let g={custom:function(e){let{data:t,id:a}=e,[r,s]=(0,n.useState)(!1),[i,c]=(0,n.useState)(!1),[u,p]=(0,n.useState)(t.label),x=(0,n.useRef)(null);(0,n.useEffect)(()=>{r&&x.current&&(x.current.focus(),x.current.select())},[r]);let h=function(e){switch(e){case"circle":return{borderRadius:"50%"};case"diamond":return{transform:"rotate(45deg)",width:"100px",height:"100px"};default:return{borderRadius:"8px"}}}(t.style.shape),g={opacity:+!!i};return(0,l.jsxs)("div",{style:{...h,border:"1px solid ".concat(t.style.color),padding:"10px 15px",background:"#fff",minWidth:"150px",maxWidth:"400px",textAlign:"center",position:"relative"},onDoubleClick:()=>s(!0),onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:[(0,l.jsx)(o.h7,{type:"target",position:o.yX.Top,style:{...d,...g,top:"-5px"}}),r?(0,l.jsx)("div",{style:"diamond"===t.style.shape?{transform:"rotate(-45deg)"}:{},children:(0,l.jsx)("input",{ref:x,value:u,onChange:e=>p(e.target.value),onBlur:()=>{s(!1),t.onChange(a,u)},onKeyDown:e=>{"Enter"===e.key&&(s(!1),t.onChange(a,u))},className:"nodrag",style:{width:"100%",border:"1px solid #777",padding:"4px",textAlign:"center",borderRadius:"4px"}})}):(0,l.jsx)("div",{style:"diamond"===t.style.shape?{transform:"rotate(-45deg)"}:{},children:(0,l.jsx)("div",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",padding:"5px 0"},children:t.label||"..."})}),(0,l.jsx)(o.h7,{type:"source",position:o.yX.Bottom,style:{...d,...g,bottom:"-5px"}})]})}},f={custom:function(e){let{id:t,sourceX:a,sourceY:r,targetX:s,targetY:d,sourcePosition:c,targetPosition:u,data:p,markerEnd:x}=e,[h,g,f]=(0,o.Fp)({sourceX:a,sourceY:r,sourcePosition:c,targetX:s,targetY:d,targetPosition:u}),[y,b]=(0,n.useState)(!1),[m,v]=(0,n.useState)(!1),[w,k]=(0,n.useState)((null==p?void 0:p.label)||""),C=(0,n.useRef)(null);return(0,n.useEffect)(()=>{y&&C.current&&(C.current.focus(),C.current.style.height="auto",C.current.style.height="".concat(C.current.scrollHeight,"px"))},[y]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o.tE,{path:h,markerEnd:x}),(0,l.jsx)("path",{d:h,fill:"none",stroke:"transparent",strokeWidth:20,className:"react-flow__edge-interaction",onClick:()=>{y||v(!m)}}),(0,l.jsx)(o.rV,{children:(0,l.jsx)("div",{style:{position:"absolute",transform:"translate(-50%, -50%) translate(".concat(g,"px,").concat(f,"px)"),pointerEvents:"all",display:m||y?"block":"none"},className:"nodrag nopan",onDoubleClick:()=>{b(!0),v(!0)},children:y?(0,l.jsx)("textarea",{ref:C,value:w,onChange:e=>{k(e.target.value),C.current&&(C.current.style.height="auto",C.current.style.height="".concat(e.target.scrollHeight,"px"))},onBlur:()=>{b(!1),(null==p?void 0:p.onChange)&&p.onChange(t,w)},className:"edge-input",style:{padding:"4px 6px",border:"1px solid #777",borderRadius:"4px",fontSize:"12px",textAlign:"center",minWidth:"100px",resize:"none",overflow:"hidden"},rows:1}):(0,l.jsx)("div",{className:"edge-label",style:{background:"#ffcc00",padding:"5px 10px",borderRadius:"8px",fontSize:"12px",maxWidth:"150px",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:i(null==p?void 0:p.label,10)||"..."})})})]})}},y=1,b="data-lineage-flow",m=new(h()).graphlib.Graph;m.setDefaultEdgeLabel(()=>({}));let v=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"TB",l="LR"===a;return m.setGraph({rankdir:a}),e.forEach(e=>{m.setNode(e.id,{width:172,height:36})}),t.forEach(e=>{m.setEdge(e.source,e.target)}),h().layout(m),e.forEach(e=>{let t=m.node(e.id);return e.targetPosition=l?o.yX.Left:o.yX.Top,e.sourcePosition=l?o.yX.Right:o.yX.Bottom,e.position={x:t.x-86,y:t.y-18},e}),{nodes:e,edges:t}};function w(){let[e,t]=(0,n.useState)([]),[a,d]=(0,n.useState)([]),[i,c]=(0,n.useState)([]),[u,x]=(0,n.useState)(!1),[h,m]=(0,n.useState)(null),w=(0,n.useRef)(null);(0,n.useEffect)(()=>{let e=localStorage.getItem(b);if(e)try{let a=JSON.parse(e);a&&Array.isArray(a.nodes)&&Array.isArray(a.edges)&&(t(a.nodes),d(a.edges),y=Math.max(0,...a.nodes.map(e=>parseInt(e.id,10)||0))+1)}catch(e){console.error("Error parsing flow data from localStorage",e)}x(!0)},[]),(0,n.useEffect)(()=>{if(u){let t=e.map(e=>{let{data:t,...a}=e;return{...a,data:{label:t.label,style:t.style}}}),l=a.map(e=>{let{data:t,...a}=e;return{...a,data:{label:t.label}}});localStorage.setItem(b,JSON.stringify({nodes:t,edges:l}))}},[e,a,u]);let k=(e,a)=>{t(t=>t.map(t=>(t.id===e&&(t.data.label=a),t)))},C=(e,a)=>{t(t=>t.map(t=>(t.id===e&&(t.data.style={...t.data.style,...a}),t))),m(null)},j=(e,t)=>{d(a=>a.map(a=>(a.id===e&&(a.data.label=t),a)))},S=(0,n.useCallback)(e=>t(t=>(0,o._0)(e,t)),[t]),N=(0,n.useCallback)(e=>d(t=>(0,o.zW)(e,t)),[d]),E=(0,n.useCallback)(e=>{let t={...e,type:"custom",markerEnd:{type:o.TG.ArrowClosed,width:20,height:20,color:"#000"},data:{label:"New Relation"},style:{stroke:"#000"}};d(e=>(0,o.rN)(t,e))},[d]),R=(0,n.useCallback)(()=>{let e={id:"".concat(y++),type:"custom",position:{x:400*Math.random(),y:400*Math.random()},data:{label:"Node ".concat(y-1),style:{color:"#555",shape:"rectangle"}}};t(t=>t.concat(e))},[]),A=(0,n.useCallback)(l=>{let{nodes:n,edges:o}=v(e,a,l);t([...n]),d([...o])},[e,a]);(0,n.useEffect)(()=>{let a=a=>{if(a.ctrlKey||a.metaKey){if("c"===a.key){let t=e.filter(e=>e.selected);t.length>0&&c(t)}if("v"===a.key&&i.length>0){let e=i.map(e=>({...e,id:"".concat(y++),position:{x:e.position.x+20,y:e.position.y+20},data:{...e.data,label:"".concat(e.data.label," (Copy)")},selected:!1}));t(t=>t.concat(e))}}};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[e,i]);let B=(0,n.useCallback)((e,t)=>{e.preventDefault();let a=e.target.closest(".react-flow__pane");if(!a)return;let l=a.getBoundingClientRect();m({id:t.id,top:e.clientY-l.top,left:e.clientX-l.left})},[m]),O=(0,n.useCallback)(()=>m(null),[m]),_=e.map(e=>({...e,data:{...e.data,onChange:k,onStyleChange:C}})),z=a.map(e=>({...e,data:{...e.data,onChange:j}}));return u?(0,l.jsxs)("div",{style:{height:"calc(100vh - 80px)"},children:[(0,l.jsxs)("div",{className:"absolute top-4 right-4 z-10 flex flex-col gap-2 w-40",children:[(0,l.jsx)("button",{onClick:R,className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded text-left w-full",children:"Add Node"}),(0,l.jsx)("button",{onClick:()=>A("TB"),className:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded text-left w-full",children:"Auto Layout"}),(0,l.jsx)("button",{onClick:()=>{let t=e.map(e=>{let{data:t,...a}=e;return{...a,data:{label:t.label,style:t.style}}}),l=a.map(e=>{let{data:t,...a}=e;return{...a,data:{label:t.label}}}),n="data:text/json;charset=utf-8,".concat(encodeURIComponent(JSON.stringify({nodes:t,edges:l},null,2))),o=document.createElement("a");o.href=n,o.download="data-lineage.json",o.click()},className:"bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded text-left w-full",children:"Export JSON"}),(0,l.jsx)("button",{onClick:()=>{var e;return null==(e=w.current)?void 0:e.click()},className:"bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded text-left w-full",children:"Import JSON"}),(0,l.jsx)("input",{type:"file",ref:w,onChange:e=>{var a;let l=null==(a=e.target.files)?void 0:a[0];if(!l)return;let n=new FileReader;n.onload=e=>{try{var a;let l=JSON.parse(null==(a=e.target)?void 0:a.result);l&&Array.isArray(l.nodes)&&Array.isArray(l.edges)?(t(l.nodes),d(l.edges),y=Math.max(0,...l.nodes.map(e=>parseInt(e.id,10)||0))+1):alert("Invalid JSON format.")}catch(e){console.error(e),alert("Error parsing JSON file.")}},n.readAsText(l),e.target.value=""},accept:".json",style:{display:"none"}})]}),(0,l.jsxs)(o.Gc,{nodes:_,edges:z,onNodesChange:S,onEdgesChange:N,onConnect:E,nodeTypes:g,edgeTypes:f,onPaneClick:O,onNodeContextMenu:B,fitView:!0,children:[(0,l.jsx)(r.H,{}),(0,l.jsx)(s.V,{}),h&&(0,l.jsx)(p,{...h,onClose:()=>m(null),onStyleChange:C})]})]}):null}},85692:(e,t,a)=>{Promise.resolve().then(a.bind(a,53428))}},e=>{var t=t=>e(e.s=t);e.O(0,[294,702,399,441,684,358],()=>t(85692)),_N_E=e.O()}]);